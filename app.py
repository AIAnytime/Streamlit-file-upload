import streamlit as st
import requests

st.set_page_config(page_title="SOAP Note Generator", layout="centered")
st.title("üìù SOAP Note Generator")
st.markdown("Upload a `.txt` file of unstructured patient notes and get a structured SOAP output generated by AI.")

uploaded_file = st.file_uploader("Upload a text file", type="txt")

if uploaded_file:
    st.success(f"Uploaded: {uploaded_file.name}")
    with st.spinner("Generating SOAP note via AI agent..."):

        # Prepare file for n8n webhook
        files = {
            "file": (uploaded_file.name, uploaded_file.read(), "text/plain")
        }

        # POST to your n8n Cloud webhook
        webhook_url = "https://sonudemo07.app.n8n.cloud/webhook/5f17edc7-7a68-4e7a-9495-4ce0554f454c"

        try:
            response = requests.post(webhook_url, files=files)

            if response.status_code == 200:
                soap_note = response.json().get("soapNote", "No SOAP note returned.")
                st.subheader("üìã Generated SOAP Note")
                st.text_area("SOAP Output", soap_note, height=400)
            else:
                st.error(f"Failed with status {response.status_code}: {response.text}")

        except Exception as e:
            st.error(f"An error occurred: {e}")
